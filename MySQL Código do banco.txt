-- Cria o banco de dados se não existir
CREATE DATABASE IF NOT EXISTS projeto_patrica;
USE projeto_patrica;

-- Tabela de formas de pagamento
CREATE TABLE IF NOT EXISTS FORMA_PAGAMENTO
(
    ID_FORMA_PAGAMENTO INT AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO VARCHAR(100) NOT NULL UNIQUE,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL
);

-- Tabela de condições de pagamento
CREATE TABLE IF NOT EXISTS CONDICAO_PAGAMENTO 
(
    ID_CONDICAO_PAGAMENTO INT AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO VARCHAR(100) NOT NULL UNIQUE,
    QUANTIDADE_PARCELAS INT NOT NULL,
    JUROS DECIMAL(5,2) NOT NULL DEFAULT 0,
    MULTA DECIMAL(5,2) NOT NULL DEFAULT 0,
    DESCONTO DECIMAL(5,2) NOT NULL DEFAULT 0,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL
);

-- Tabela de parcelas da condição de pagamento
CREATE TABLE IF NOT EXISTS PARCELA_CONDICAO_PAGAMENTO 
(
    ID_CONDICAO_PAGAMENTO INT NOT NULL,
    NUMERO_PARCELA INT NOT NULL,
    ID_FORMA_PAGAMENTO INT NOT NULL,
    VALOR_PERCENTUAL DECIMAL(5,2) NOT NULL,
    DIAS_APOS_VENDA INT NOT NULL,
    PRIMARY KEY (ID_CONDICAO_PAGAMENTO, NUMERO_PARCELA),
    CONSTRAINT FK_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Forma FOREIGN KEY (ID_FORMA_PAGAMENTO) REFERENCES FORMA_PAGAMENTO(ID_FORMA_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de países
CREATE TABLE IF NOT EXISTS PAIS
(
    ID_PAIS INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL UNIQUE,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL
);

-- Tabela de estados
CREATE TABLE IF NOT EXISTS ESTADO
(
    ID_ESTADO INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    ID_PAIS INT NOT NULL,
    CONSTRAINT UC_Estado UNIQUE (NOME, ID_PAIS),
    CONSTRAINT FK_Estado_Pais FOREIGN KEY (ID_PAIS) REFERENCES PAIS(ID_PAIS)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL
);

-- Tabela de cidades
CREATE TABLE IF NOT EXISTS CIDADE
(
    ID_CIDADE INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    ID_ESTADO INT NOT NULL,
    CONSTRAINT UC_Cidade UNIQUE (NOME, ID_ESTADO),
    CONSTRAINT FK_Cidade_Estado FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID_ESTADO)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL
);

-- Tabela de funcionários
CREATE TABLE IF NOT EXISTS FUNCIONARIO
(
    ID_FUNCIONARIO INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1) NOT NULL,
    NOME_RAZAO_SOCIAL VARCHAR(100) NOT NULL,
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE NOT NULL,
    CPF_CNPJ VARCHAR(20) UNIQUE NULL,
    RG_INSCRICAO_ESTADUAL VARCHAR(20) UNIQUE NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEFONE VARCHAR(20) NOT NULL,
    ENDERECO VARCHAR(100) NOT NULL,
    NUMERO_ENDERECO VARCHAR(20) NOT NULL,
    COMPLEMENTO_ENDERECO VARCHAR(50) NULL,
    BAIRRO VARCHAR(50) NOT NULL,
    ID_CIDADE INT NOT NULL,
    CEP VARCHAR(10) NOT NULL,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    MATRICULA VARCHAR(20) UNIQUE NOT NULL,
    CARGO VARCHAR(50) NOT NULL,
    SALARIO DECIMAL(10,2) NOT NULL,
    DATA_ADMISSAO DATE NOT NULL,
    DATA_DEMISSAO DATE NULL,
    TURNO VARCHAR(20) NOT NULL,
    CARGA_HORARIA INT NOT NULL,
    GENERO CHAR(1) NOT NULL,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL,
    CONSTRAINT FK_Funcionario_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de clientes
CREATE TABLE IF NOT EXISTS CLIENTE
(
    ID_CLIENTE INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1) NOT NULL,
    NOME_RAZAO_SOCIAL VARCHAR(100) NOT NULL,
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE NOT NULL,
    CPF_CNPJ VARCHAR(20) UNIQUE NULL,
    RG_INSCRICAO_ESTADUAL VARCHAR(20) UNIQUE NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEFONE VARCHAR(20) NOT NULL,
    ENDERECO VARCHAR(100) NOT NULL,
    NUMERO_ENDERECO VARCHAR(20) NOT NULL,
    COMPLEMENTO_ENDERECO VARCHAR(50) NULL,
    BAIRRO VARCHAR(50) NOT NULL,
    ID_CIDADE INT NOT NULL,
    CEP VARCHAR(10) NULL,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    GENERO CHAR(1) NULL,
    ID_CONDICAO_PAGAMENTO INT NOT NULL,
    LIMITE_CREDITO DECIMAL(10,2) NULL,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL,
    CONSTRAINT FK_Cliente_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT FK_Cliente_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de fornecedores
CREATE TABLE IF NOT EXISTS FORNECEDOR
(
    ID_FORNECEDOR INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1) NOT NULL,
    NOME_RAZAO_SOCIAL VARCHAR(100) NOT NULL,
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE NOT NULL,
    CPF_CNPJ VARCHAR(20) UNIQUE NULL,
    RG_INSCRICAO_ESTADUAL VARCHAR(20) UNIQUE NOT NULL,
    EMAIL VARCHAR(100) NOT NULL,
    TELEFONE VARCHAR(20) NOT NULL,
    ENDERECO VARCHAR(100) NOT NULL,
    NUMERO_ENDERECO VARCHAR(20) NOT NULL,
    COMPLEMENTO_ENDERECO VARCHAR(50) NULL,
    BAIRRO VARCHAR(50) NOT NULL,
    ID_CIDADE INT NOT NULL,
    CEP VARCHAR(10) NOT NULL,
    ATIVO BOOLEAN NOT NULL DEFAULT TRUE,
    GENERO CHAR(1) NULL,
    ID_CONDICAO_PAGAMENTO INT NOT NULL,
    DATA_CADASTRO DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DATA_ULTIMA_EDICAO DATE NULL,
    CONSTRAINT FK_Fornecedor_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT FK_Fornecedor_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);
