-- Cria o banco de dados se não existir
CREATE DATABASE IF NOT EXISTS projeto_patrica;
USE projeto_patrica;

-- Tabela de formas de pagamento
CREATE TABLE IF NOT EXISTS FORMA_PAGAMENTO
(
    ID_FORMA_PAGAMENTO INT AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO VARCHAR(100) NOT NULL UNIQUE
);

-- Tabela de condições de pagamento
CREATE TABLE IF NOT EXISTS CONDICAO_PAGAMENTO 
(
    ID_CONDICAO_PAGAMENTO INT AUTO_INCREMENT PRIMARY KEY,
    DESCRICAO VARCHAR(100) NOT NULL UNIQUE,
    QUANTIDADE_PARCELAS INT NOT NULL
);

-- Tabela de parcelas da condição de pagamento
CREATE TABLE IF NOT EXISTS PARCELA_CONDICAO_PAGAMENTO 
(
    ID_CONDICAO_PAGAMENTO INT NOT NULL,
    NUMERO_PARCELA INT NOT NULL,
    ID_FORMA_PAGAMENTO INT NOT NULL,
    VALOR_PERCENTUAL DECIMAL(5,2) NOT NULL,
    DIAS_APOS_VENDA INT NOT NULL,
    PRIMARY KEY (ID_CONDICAO_PAGAMENTO, NUMERO_PARCELA),
    CONSTRAINT FK_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Forma FOREIGN KEY (ID_FORMA_PAGAMENTO) REFERENCES FORMA_PAGAMENTO(ID_FORMA_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de países
CREATE TABLE IF NOT EXISTS PAIS
(
    ID_PAIS INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL UNIQUE
);

-- Tabela de estados
CREATE TABLE IF NOT EXISTS ESTADO
(
    ID_ESTADO INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    ID_PAIS INT NOT NULL,
    CONSTRAINT UC_Estado UNIQUE (NOME, ID_PAIS),
    CONSTRAINT FK_Estado_Pais FOREIGN KEY (ID_PAIS) REFERENCES PAIS(ID_PAIS)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de cidades
CREATE TABLE IF NOT EXISTS CIDADE
(
    ID_CIDADE INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    ID_ESTADO INT NOT NULL,
    CONSTRAINT UC_Cidade UNIQUE (NOME, ID_ESTADO),
    CONSTRAINT FK_Cidade_Estado FOREIGN KEY (ID_ESTADO) REFERENCES ESTADO(ID_ESTADO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de funcionários
CREATE TABLE IF NOT EXISTS FUNCIONARIO
(
    ID_FUNCIONARIO INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1),
    NOME_RAZAO_SOCIAL VARCHAR(100),
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE,
    CPF_CNPJ VARCHAR(20) UNIQUE,
    RG_INSCRICAO_ESTADUAL VARCHAR(20),
    EMAIL VARCHAR(100) UNIQUE,
    TELEFONE VARCHAR(20),
    ENDERECO VARCHAR(100),
    BAIRRO VARCHAR(50),
    ID_CIDADE INT,
    CEP VARCHAR(10),
    ATIVO BOOLEAN,
    MATRICULA INT UNIQUE,
    CARGO VARCHAR(50),
    SALARIO FLOAT,
    DATA_ADMISSAO DATE,
    TURNO VARCHAR(20),
    CARGA_HORARIA INT,
    GENERO CHAR(1),
    CONSTRAINT FK_Funcionario_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de clientes
CREATE TABLE IF NOT EXISTS CLIENTE
(
    ID_CLIENTE INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1),
    NOME_RAZAO_SOCIAL VARCHAR(100),
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE,
    CPF_CNPJ VARCHAR(20) UNIQUE,
    RG_INSCRICAO_ESTADUAL VARCHAR(20),
    EMAIL VARCHAR(100) UNIQUE,
    TELEFONE VARCHAR(20),
    ENDERECO VARCHAR(100),
    BAIRRO VARCHAR(50),
    ID_CIDADE INT,
    CEP VARCHAR(10),
    ATIVO BOOLEAN,
    GENERO CHAR(1) NULL,
    ID_CONDICAO_PAGAMENTO INT,
    CONSTRAINT FK_Cliente_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT FK_Cliente_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);

-- Tabela de fornecedores
CREATE TABLE IF NOT EXISTS FORNECEDOR
(
    ID_FORNECEDOR INT AUTO_INCREMENT PRIMARY KEY,
    TIPO_PESSOA CHAR(1),
    NOME_RAZAO_SOCIAL VARCHAR(100),
    APELIDO_NOME_FANTASIA VARCHAR(100) NULL,
    DATA_NASCIMENTO_CRIACAO DATE,
    CPF_CNPJ VARCHAR(20) UNIQUE,
    RG_INSCRICAO_ESTADUAL VARCHAR(20),
    EMAIL VARCHAR(100) UNIQUE,
    TELEFONE VARCHAR(20),
    ENDERECO VARCHAR(100),
    BAIRRO VARCHAR(50),
    ID_CIDADE INT,
    CEP VARCHAR(10),
    ATIVO BOOLEAN,
    INSCRICAO_MUNICIPAL VARCHAR(30) NULL,
    INSCRICAO_ESTADUAL_SUBS_TRIB VARCHAR(30) NULL,
    GENERO CHAR(1),
    ID_CONDICAO_PAGAMENTO INT,
    CONSTRAINT FK_Fornecedor_Cidade FOREIGN KEY (ID_CIDADE) REFERENCES CIDADE(ID_CIDADE)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT FK_Fornecedor_Condicao FOREIGN KEY (ID_CONDICAO_PAGAMENTO) REFERENCES CONDICAO_PAGAMENTO(ID_CONDICAO_PAGAMENTO)
        ON DELETE RESTRICT ON UPDATE CASCADE
);
